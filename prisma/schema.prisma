// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// ==================== USER ====================
model User {
  id           Int      @id @default(autoincrement())
  username     String   @unique
  passwordHash String
  role         String   @default("teacher") // "admin" | "teacher"
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  notifications Notification[]
  dashboardPreference UserDashboardPreference?
}

// ==================== TEACHER ====================
model Teacher {
  id           Int      @id @default(autoincrement())
  name         String
  email        String   @unique
  title        String   @default("Öğr. Gör.") // Akademik ünvan
  faculty      String
  department   String
  workingHours String   @default("{}") // JSON string - 1 saatlik periyotlar
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  courses      Course[]
}

// ==================== COURSE ====================
model Course {
  id                 Int                 @id @default(autoincrement())
  name               String
  code               String              @unique
  teacherId          Int?
  teacher            Teacher?            @relation(fields: [teacherId], references: [id])
  faculty            String
  level              String              @default("1")
  category           String              @default("zorunlu") // "zorunlu" | "secmeli"
  semester           String              @default("güz")
  ects               Int                 @default(3)
  totalHours         Int                 @default(2)
  capacityMargin     Int                 @default(0)  // Opsiyonel kapasite marjı (0-30%)
  isActive           Boolean             @default(true)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  sessions           CourseSession[]
  departments        CourseDepartment[]
  schedules          Schedule[]
  hardcodedSchedules HardcodedSchedule[]
}

// ==================== COURSE SESSION ====================
model CourseSession {
  id       Int    @id @default(autoincrement())
  courseId Int
  course   Course @relation(fields: [courseId], references: [id], onDelete: Cascade)
  type     String @default("teorik") // "teorik" | "lab" | "tümü"
  hours    Int    @default(2)
}

// ==================== COURSE DEPARTMENT ====================
model CourseDepartment {
  id           Int    @id @default(autoincrement())
  courseId     Int
  course       Course @relation(fields: [courseId], references: [id], onDelete: Cascade)
  department   String
  studentCount Int    @default(0)
}

// ==================== CLASSROOM ====================
model Classroom {
  id                 Int                 @id @default(autoincrement())
  name               String
  capacity           Int                 @default(30)
  type               String              @default("teorik") // "teorik" | "lab"
  faculty            String
  department         String
  priorityDept       String?             // Öncelikli bölüm kodu (örn: "YMH")
  availableHours     String              @default("{}") // JSON - Uygunluk saatleri
  isActive           Boolean             @default(true)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  schedules          Schedule[]
  hardcodedSchedules HardcodedSchedule[]

  @@unique([name, department])
}

// ==================== SCHEDULE ====================
model Schedule {
  id          Int       @id @default(autoincrement())
  day         String    // "Pazartesi", "Salı", etc.
  timeRange   String    // "09:00-10:00"
  courseId    Int
  course      Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)
  classroomId Int
  classroom   Classroom @relation(fields: [classroomId], references: [id], onDelete: Cascade)
  isHardcoded Boolean   @default(false) // Hardcoded mi?
  sessionType String    @default("teorik") // "teorik" | "lab"
  createdAt   DateTime  @default(now())
}

// ==================== HARDCODED SCHEDULE ====================
model HardcodedSchedule {
  id          Int        @id @default(autoincrement())
  courseId    Int
  course      Course     @relation(fields: [courseId], references: [id], onDelete: Cascade)
  sessionType String     @default("teorik") // "teorik" | "lab"
  day         String     // "Pazartesi", "Salı", etc.
  startTime   String     // "09:00"
  endTime     String     // "10:00"
  classroomId Int?       // Opsiyonel derslik
  classroom   Classroom? @relation(fields: [classroomId], references: [id])
  createdAt   DateTime   @default(now())
}

// ==================== NOTIFICATIONS ====================
model Notification {
  id          Int       @id @default(autoincrement())
  title       String
  message     String
  type        String    @default("info") // "info" | "success" | "warning" | "error"
  category    String    @default("general") // "schedule" | "teacher" | "course" | "classroom" | "general"
  userId      Int?
  user        User?     @relation(fields: [userId], references: [id])
  isRead      Boolean   @default(false)
  actionUrl   String?   // Bildirime tıklandığında yönlendirme URL'i
  data        String?   // JSON string - ek veriler için
  createdAt   DateTime  @default(now())
  readAt      DateTime?
}

// ==================== USER DASHBOARD PREFERENCES ====================
model UserDashboardPreference {
  id          Int       @id @default(autoincrement())
  userId      Int       @unique
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  widgets     String    @default("[]") // JSON array - widget konfigürasyonu
  layout      String    @default("{}") // JSON object - layout ayarları
  theme       String    @default("default") // Tema seçeneği
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

// ==================== SYSTEM SETTINGS ====================
model SystemSettings {
  id                    Int      @id @default(autoincrement())
  capacityMarginEnabled Boolean  @default(false)
  capacityMarginPercent Int      @default(0) // 0-30 arası
  // Time configuration
  slotDuration          Int      @default(60)       // 30 veya 60 dakika
  dayStart              String   @default("08:00")
  dayEnd                String   @default("18:00")
  lunchBreakStart       String   @default("12:00")
  lunchBreakEnd         String   @default("13:00")
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}
